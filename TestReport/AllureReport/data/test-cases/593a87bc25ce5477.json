{"uid":"593a87bc25ce5477","name":"Create_Sample_Form_success_表单创建成功","fullName":"TestCase.Test_create_sample_form.TestCreateSampleForm#test_create_sample_form","historyId":"6b3691d0acee37b01b81c0240f9c5681","time":{"start":1766719092666,"stop":1766719114225,"duration":21559},"status":"broken","statusMessage":"Exception: ❌ 表单创建操作失败，错误：超时15秒，元素仍未可见！定位器：//*[@id=\":r4u:\"]/div/div/div[1]/div/div/img，frame：None","statusTrace":"self = <Test_create_sample_form.TestCreateSampleForm object at 0x1082f7b50>\nlogged_in_page = <Page url='https://drv-dev-16.shimorelease.com/recent'>\nCaseData = {'url': '/recent', '功能': '创建表单', '是否执行': 'Y', '用例标题': '表单创建成功', ...}\n\n    @pytest.mark.order(2)  # 登录用例之后执行\n    @AllurePretty.AllurePretty_Warpper\n    # 参数化：读取创建表单的测试数据\n    @pytest.mark.parametrize(\n        \"CaseData\",\n        ReadYaml(os.path.join(Config.test_datas_dir, \"TestCreateForm.yaml\")).read()\n    )\n    def test_create_sample_form(self, logged_in_page, CaseData):\n        page = logged_in_page\n        # 导航到目标页面（如果当前不在目标页面）\n        target_url = Config.Base_url + CaseData.get(\"url\", \"/recent\")\n        if page.url != target_url and \"about:blank\" in page.url:\n            page.goto(target_url, wait_until=\"domcontentloaded\", timeout=30000)\n            page.wait_for_load_state(\"networkidle\", timeout=15000)\n    \n        create_form_page = CreateFormPage(page)\n        current_url = page.url\n        print(f\"✅ 登录后当前页面：{current_url}\")\n    \n        # 3. 执行创建表单操作（每个操作前等待元素，避免点击失败）\n        try:\n            # 点击创建按钮\n            create_form_page.click_create_button()\n            print(\"✅ 点击创建按钮成功\")\n    \n            # 悬浮到表单按钮\n            create_form_page.hover_hover_form_button()\n            print(\"✅ 悬浮表单按钮成功\")\n    \n            # 点击创建示例表单按钮\n>           create_form_page.click_create_sample_form_button()\n\nTestCase/Test_create_sample_form.py:41: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\nPages/CreateFormPage.py:44: in click_create_sample_form_button\n    self.ele_to_be_visible_force(self.create_sample_form_button, timeout=15)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\n\nself = <Pages.CreateFormPage.CreateFormPage object at 0x108906390>\nlocator = '//*[@id=\":r4u:\"]/div/div/div[1]/div/div/img', frame_locator = None\ntimeout = 15\n\n    def ele_to_be_visible_force(self, locator, frame_locator=None, timeout: int = 5):\n        # 1. 区分frame内/外元素，获取正确的等待对象\n        wait_target = self.page\n        if frame_locator is not None:\n            # 先定位frame，再基于frame等待元素\n            wait_target = self.page.frame_locator(frame_locator)\n    \n        # 2. 循环重试等待元素可见（每500ms检查一次）\n        total_checks = timeout * 2  # 总检查次数（5秒→10次）\n        for _ in range(total_checks):\n            try:\n                # 关键修正：移除frame参数，根据wait_target（page/frame）调用wait_for_selector\n                wait_target.wait_for_selector(\n                    locator,  # 元素选择器（字符串，必传）\n                    state=\"visible\",  # 等待元素\"可见\"\n                    timeout=500  # 单次检查超时（500ms）\n                )\n                # 定位元素并二次确认可见性\n                if frame_locator is not None:\n                    ele = self.page.frame_locator(frame_locator).locator(locator)\n                else:\n                    ele = self.page.locator(locator)\n    \n                if ele.is_visible():\n                    return ele\n            except PlaywrightTimeoutError:\n                # 单次超时不抛错，继续重试\n                continue\n    \n        # 3. 总超时后抛明确异常\n>       raise Exception(f\"超时{timeout}秒，元素仍未可见！定位器：{locator}，frame：{frame_locator}\")\nE       Exception: 超时15秒，元素仍未可见！定位器：//*[@id=\":r4u:\"]/div/div/div[1]/div/div/img，frame：None\n\nBasePage/BasePage.py:109: Exception\n\nDuring handling of the above exception, another exception occurred:\n\nself = <Test_create_sample_form.TestCreateSampleForm object at 0x1082f7b50>\nlogged_in_page = <Page url='https://drv-dev-16.shimorelease.com/recent'>\nCaseData = {'url': '/recent', '功能': '创建表单', '是否执行': 'Y', '用例标题': '表单创建成功', ...}\n\n    @pytest.mark.order(2)  # 登录用例之后执行\n    @AllurePretty.AllurePretty_Warpper\n    # 参数化：读取创建表单的测试数据\n    @pytest.mark.parametrize(\n        \"CaseData\",\n        ReadYaml(os.path.join(Config.test_datas_dir, \"TestCreateForm.yaml\")).read()\n    )\n    def test_create_sample_form(self, logged_in_page, CaseData):\n        page = logged_in_page\n        # 导航到目标页面（如果当前不在目标页面）\n        target_url = Config.Base_url + CaseData.get(\"url\", \"/recent\")\n        if page.url != target_url and \"about:blank\" in page.url:\n            page.goto(target_url, wait_until=\"domcontentloaded\", timeout=30000)\n            page.wait_for_load_state(\"networkidle\", timeout=15000)\n    \n        create_form_page = CreateFormPage(page)\n        current_url = page.url\n        print(f\"✅ 登录后当前页面：{current_url}\")\n    \n        # 3. 执行创建表单操作（每个操作前等待元素，避免点击失败）\n        try:\n            # 点击创建按钮\n            create_form_page.click_create_button()\n            print(\"✅ 点击创建按钮成功\")\n    \n            # 悬浮到表单按钮\n            create_form_page.hover_hover_form_button()\n            print(\"✅ 悬浮表单按钮成功\")\n    \n            # 点击创建示例表单按钮\n            create_form_page.click_create_sample_form_button()\n            print(\"✅ 点击创建示例表单按钮成功\")\n        except Exception as e:\n>           raise Exception(f\"❌ 表单创建操作失败，错误：{str(e)}\")\nE           Exception: ❌ 表单创建操作失败，错误：超时15秒，元素仍未可见！定位器：//*[@id=\":r4u:\"]/div/div/div[1]/div/div/img，frame：None\n\nTestCase/Test_create_sample_form.py:44: Exception","flaky":false,"newFailed":false,"newBroken":false,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[{"name":"_session_faker","time":{"start":1766719082252,"stop":1766719082291,"duration":39},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"django_test_environment","time":{"start":1766719082291,"stop":1766719082292,"duration":1},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"_fail_for_invalid_template_variable","time":{"start":1766719082291,"stop":1766719082291,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"_verify_url","time":{"start":1766719082292,"stop":1766719082292,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"base_url","time":{"start":1766719082292,"stop":1766719082292,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"delete_output_dir","time":{"start":1766719082292,"stop":1766719082292,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"pytestconfig","time":{"start":1766719082292,"stop":1766719082292,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"django_db_blocker","time":{"start":1766719082292,"stop":1766719082292,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"browser","time":{"start":1766719082292,"stop":1766719083666,"duration":1374},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"clear_auth","time":{"start":1766719082292,"stop":1766719082292,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"context","time":{"start":1766719083667,"stop":1766719083936,"duration":269},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"logged_in_page","time":{"start":1766719089302,"stop":1766719092664,"duration":3362},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"_django_setup_unittest","time":{"start":1766719092664,"stop":1766719092664,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"_live_server_helper","time":{"start":1766719092665,"stop":1766719092665,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"_django_set_urlconf","time":{"start":1766719092665,"stop":1766719092665,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"monkeypatch","time":{"start":1766719092665,"stop":1766719092665,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"_dj_autoclear_mailbox","time":{"start":1766719092665,"stop":1766719092665,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"_django_clear_site_cache","time":{"start":1766719092665,"stop":1766719092665,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"_django_db_marker","time":{"start":1766719092665,"stop":1766719092665,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"_template_string_if_invalid_marker","time":{"start":1766719092666,"stop":1766719092666,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"testStage":{"status":"broken","statusMessage":"Exception: ❌ 表单创建操作失败，错误：超时15秒，元素仍未可见！定位器：//*[@id=\":r4u:\"]/div/div/div[1]/div/div/img，frame：None","statusTrace":"self = <Test_create_sample_form.TestCreateSampleForm object at 0x1082f7b50>\nlogged_in_page = <Page url='https://drv-dev-16.shimorelease.com/recent'>\nCaseData = {'url': '/recent', '功能': '创建表单', '是否执行': 'Y', '用例标题': '表单创建成功', ...}\n\n    @pytest.mark.order(2)  # 登录用例之后执行\n    @AllurePretty.AllurePretty_Warpper\n    # 参数化：读取创建表单的测试数据\n    @pytest.mark.parametrize(\n        \"CaseData\",\n        ReadYaml(os.path.join(Config.test_datas_dir, \"TestCreateForm.yaml\")).read()\n    )\n    def test_create_sample_form(self, logged_in_page, CaseData):\n        page = logged_in_page\n        # 导航到目标页面（如果当前不在目标页面）\n        target_url = Config.Base_url + CaseData.get(\"url\", \"/recent\")\n        if page.url != target_url and \"about:blank\" in page.url:\n            page.goto(target_url, wait_until=\"domcontentloaded\", timeout=30000)\n            page.wait_for_load_state(\"networkidle\", timeout=15000)\n    \n        create_form_page = CreateFormPage(page)\n        current_url = page.url\n        print(f\"✅ 登录后当前页面：{current_url}\")\n    \n        # 3. 执行创建表单操作（每个操作前等待元素，避免点击失败）\n        try:\n            # 点击创建按钮\n            create_form_page.click_create_button()\n            print(\"✅ 点击创建按钮成功\")\n    \n            # 悬浮到表单按钮\n            create_form_page.hover_hover_form_button()\n            print(\"✅ 悬浮表单按钮成功\")\n    \n            # 点击创建示例表单按钮\n>           create_form_page.click_create_sample_form_button()\n\nTestCase/Test_create_sample_form.py:41: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\nPages/CreateFormPage.py:44: in click_create_sample_form_button\n    self.ele_to_be_visible_force(self.create_sample_form_button, timeout=15)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\n\nself = <Pages.CreateFormPage.CreateFormPage object at 0x108906390>\nlocator = '//*[@id=\":r4u:\"]/div/div/div[1]/div/div/img', frame_locator = None\ntimeout = 15\n\n    def ele_to_be_visible_force(self, locator, frame_locator=None, timeout: int = 5):\n        # 1. 区分frame内/外元素，获取正确的等待对象\n        wait_target = self.page\n        if frame_locator is not None:\n            # 先定位frame，再基于frame等待元素\n            wait_target = self.page.frame_locator(frame_locator)\n    \n        # 2. 循环重试等待元素可见（每500ms检查一次）\n        total_checks = timeout * 2  # 总检查次数（5秒→10次）\n        for _ in range(total_checks):\n            try:\n                # 关键修正：移除frame参数，根据wait_target（page/frame）调用wait_for_selector\n                wait_target.wait_for_selector(\n                    locator,  # 元素选择器（字符串，必传）\n                    state=\"visible\",  # 等待元素\"可见\"\n                    timeout=500  # 单次检查超时（500ms）\n                )\n                # 定位元素并二次确认可见性\n                if frame_locator is not None:\n                    ele = self.page.frame_locator(frame_locator).locator(locator)\n                else:\n                    ele = self.page.locator(locator)\n    \n                if ele.is_visible():\n                    return ele\n            except PlaywrightTimeoutError:\n                # 单次超时不抛错，继续重试\n                continue\n    \n        # 3. 总超时后抛明确异常\n>       raise Exception(f\"超时{timeout}秒，元素仍未可见！定位器：{locator}，frame：{frame_locator}\")\nE       Exception: 超时15秒，元素仍未可见！定位器：//*[@id=\":r4u:\"]/div/div/div[1]/div/div/img，frame：None\n\nBasePage/BasePage.py:109: Exception\n\nDuring handling of the above exception, another exception occurred:\n\nself = <Test_create_sample_form.TestCreateSampleForm object at 0x1082f7b50>\nlogged_in_page = <Page url='https://drv-dev-16.shimorelease.com/recent'>\nCaseData = {'url': '/recent', '功能': '创建表单', '是否执行': 'Y', '用例标题': '表单创建成功', ...}\n\n    @pytest.mark.order(2)  # 登录用例之后执行\n    @AllurePretty.AllurePretty_Warpper\n    # 参数化：读取创建表单的测试数据\n    @pytest.mark.parametrize(\n        \"CaseData\",\n        ReadYaml(os.path.join(Config.test_datas_dir, \"TestCreateForm.yaml\")).read()\n    )\n    def test_create_sample_form(self, logged_in_page, CaseData):\n        page = logged_in_page\n        # 导航到目标页面（如果当前不在目标页面）\n        target_url = Config.Base_url + CaseData.get(\"url\", \"/recent\")\n        if page.url != target_url and \"about:blank\" in page.url:\n            page.goto(target_url, wait_until=\"domcontentloaded\", timeout=30000)\n            page.wait_for_load_state(\"networkidle\", timeout=15000)\n    \n        create_form_page = CreateFormPage(page)\n        current_url = page.url\n        print(f\"✅ 登录后当前页面：{current_url}\")\n    \n        # 3. 执行创建表单操作（每个操作前等待元素，避免点击失败）\n        try:\n            # 点击创建按钮\n            create_form_page.click_create_button()\n            print(\"✅ 点击创建按钮成功\")\n    \n            # 悬浮到表单按钮\n            create_form_page.hover_hover_form_button()\n            print(\"✅ 悬浮表单按钮成功\")\n    \n            # 点击创建示例表单按钮\n            create_form_page.click_create_sample_form_button()\n            print(\"✅ 点击创建示例表单按钮成功\")\n        except Exception as e:\n>           raise Exception(f\"❌ 表单创建操作失败，错误：{str(e)}\")\nE           Exception: ❌ 表单创建操作失败，错误：超时15秒，元素仍未可见！定位器：//*[@id=\":r4u:\"]/div/div/div[1]/div/div/img，frame：None\n\nTestCase/Test_create_sample_form.py:44: Exception","steps":[{"name":"添加失败截图","time":{"start":1766719114236,"stop":1766719114380,"duration":144},"status":"passed","steps":[],"attachments":[{"uid":"72b0fb1f727d3832","name":"失败截图:","source":"72b0fb1f727d3832.png","type":"image/png","size":211198}],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":1,"hasContent":true,"attachmentStep":false}],"attachments":[],"parameters":[],"stepsCount":1,"shouldDisplayMessage":true,"attachmentsCount":1,"hasContent":true,"attachmentStep":false},"afterStages":[{"name":"_live_server_helper::0","time":{"start":1766719114383,"stop":1766719114383,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"_django_set_urlconf::0","time":{"start":1766719114383,"stop":1766719114383,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"monkeypatch::0","time":{"start":1766719114383,"stop":1766719114383,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"_django_setup_unittest::0","time":{"start":1766719114384,"stop":1766719114384,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"logged_in_page::0","time":{"start":1766719114385,"stop":1766719114385,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"context::0","time":{"start":1766719114385,"stop":1766719114421,"duration":36},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"browser::0","time":{"start":1766719114422,"stop":1766719120019,"duration":5597},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"clear_auth::0","time":{"start":1766719120024,"stop":1766719120024,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"django_test_environment::0","time":{"start":1766719120025,"stop":1766719120025,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"_fail_for_invalid_template_variable::0","time":{"start":1766719120025,"stop":1766719120025,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"labels":[{"name":"feature"},{"name":"story","value":"创建表单"},{"name":"severity"},{"name":"tag","value":"order(2)"},{"name":"parentSuite","value":"TestCase"},{"name":"suite","value":"Test_create_sample_form"},{"name":"subSuite","value":"TestCreateSampleForm"},{"name":"host","value":"AlindeMacBook-Pro.local"},{"name":"thread","value":"38230-MainThread"},{"name":"framework","value":"pytest"},{"name":"language","value":"cpython3"},{"name":"package","value":"TestCase.Test_create_sample_form"},{"name":"resultFormat","value":"allure2"}],"parameters":[{"name":"CaseData","value":"{'用例编号': 'Create_Sample_Form_success', '功能': '创建表单', '是否执行': 'Y', '用例标题': '表单创建成功', 'url': '/recent'}"}],"links":[],"hidden":false,"retry":false,"extra":{"severity":"normal","retries":[],"categories":[{"name":"Test defects","matchedStatuses":[]}],"tags":["order(2)"]},"source":"593a87bc25ce5477.json","parameterValues":["{'用例编号': 'Create_Sample_Form_success', '功能': '创建表单', '是否执行': 'Y', '用例标题': '表单创建成功', 'url': '/recent'}"]}